{
  "name": "accounts-server-doc",
  "version": "1.0.0",
  "description": "JobSity Challenge Account Server API Documentation",
  "title": "JobSity Challenge Account Server API Documentation",
  "url": "https://accounts.jobsity.ikoabo.com",
  "header": {
    "title": "Account Server API",
    "content": "<h1>Account Management Server</h1>\n<p>Account Management Server is an small microservice developed to allow in a simple way register/login users and authenticate request on external services to solve the JobSity Challenge.</p>\n<p>The idea behind this microservice is the OAuth2 standard, but this isn't OAuth2 implementation. The service handle three type of users, and for each type of user handle a virtual role to allow external services restrict access by user type. In this implementation the generated access token don't have expiration time and its only relationed with the account.</p>\n<h2>Installation of the service</h2>\n<ul>\n<li>Clone the repository</li>\n</ul>\n<pre class=\"prettyprint\">git clone https://gitlab.com/jobsity1/challenge/accounts-server.git\n</code></pre>\n<ul>\n<li>Install dependencies</li>\n</ul>\n<pre class=\"prettyprint\">cd accounts-server\nnpm install\n</code></pre>\n<ul>\n<li>Build the project</li>\n</ul>\n<pre class=\"prettyprint\">npm run build\n</code></pre>\n<ul>\n<li>Setup initial database (see next section for environment variables)</li>\n</ul>\n<pre class=\"prettyprint\">npm run setup\n</code></pre>\n<p>Initial database configuration generate by defaul five users:</p>\n<ul>\n<li>[User: jdoe@challenge.com; Password: challenge*2020] (Administrator)</li>\n<li>[User: janedoe@challenge.com; Password: challenge*2020]</li>\n<li>[User: chat@challenge.com; Password: challenge*2020]</li>\n<li>[User: web@challenge.com; Password: challenge*2020]</li>\n<li>[User: bot@challenge.com; Password: challenge*2020]</li>\n</ul>\n<h2>Running the service</h2>\n<p>The service can be runned directly from the command line with:</p>\n<pre class=\"prettyprint lang-bash\">npm start\n</pre>\n<p>or it can be build and runned watching for file changes</p>\n<pre class=\"prettyprint\">npm run dev\n</code></pre>\n<p>To run the service there are some environment variables that can be used to configure it:</p>\n<ul>\n<li><code>LOG</code>: Set the vebose level of the service debugger, allowed values are: error, warn, info, http, verbose, debug, silly (Default: debug)</li>\n<li><code>PORT</code>: Set the running port for the HTTP server (Default: 3000)</li>\n<li><code>INTERFACE</code>: Set the HTTP server listening interface (Default: 127.0.0.1)</li>\n<li><code>ENV</code>: Set the service running mode, allowd values are: dev, production (Default: dev)</li>\n<li><code>INSTANCES</code>: Set the number o workers runing into the cluster (Default: 1)</li>\n<li><code>MONGODB_URI</code>: Set the MongoDB database connection URI (Default: mongodb://127.0.0.1:27017/accounts_srv)</li>\n</ul>\n<h2>Deploy on server</h2>\n<h3>Run as service</h3>\n<p>To allow the microservice to run as system service, first you must install <code>pm2</code>:</p>\n<pre class=\"prettyprint\">npm i -g pm2\n</code></pre>\n<p>After that, you must create the ecosystem file to launch the service:</p>\n<pre class=\"prettyprint\">nano ecosystem.config.js\n</code></pre>\n<p>The <code>ecosystem.config.js</code> file contains the following lines:</p>\n<pre class=\"prettyprint\">module.exports = {\n  apps : [{\n    name: 'ACCOUNTS-JOBSITY',\n    script: 'dist/index.js',\n    instances: 1,\n    autorestart: true,\n    watch: false,\n    env: {\n      NODE_ENV: 'development',\n      ENV: 'dev',\n      PORT: 8001,\n      INSTANCES: 2,\n      LOG: 'debug',\n      MONGODB_URI: 'mongodb://127.0.0.1:27017/srv_accounts'\n    },\n  }],\n};\n\n</code></pre>\n<p>To start the service run the folowing lines:</p>\n<pre class=\"prettyprint\">pm2 start ecosystem.config.js\npm2 save\n</code></pre>\n<p>Now the accounts microservice is running as system service.</p>\n<h3>Configure Nginx web server</h3>\n<p>To allow access the service from external,you must configure a new virtual host in the Nginx server:</p>\n<pre class=\"prettyprint\">nano /etc/nginx/sites-availables/accounts.jobsity.ikoabo.com\n</code></pre>\n<p>With the following code:</p>\n<pre class=\"prettyprint\">upstream mod-accounts-jobsity {\n  server localhost:8001;\n}\n \nserver {\n  listen 80;\n  listen [::]:80;\n  server_name accounts.jobsity.ikoabo.com;\n\n  location / {\n    proxy_pass http://mod-accounts-jobsity/;\n    proxy_http_version 1.1;\n    proxy_cache_bypass $http_upgrade;\n    proxy_read_timeout 600s;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_set_header Host $host;\n    proxy_set_header X-Caller-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n  }\n}\n</code></pre>\n<p>And then enable the virtual host:</p>\n<pre class=\"prettyprint\">ln -s /etc/nginx/sites-available/accounts.jobsity.ikoabo.com /etc/nginx/sites-enabled/accounts.jobsity.ikoabo.com\n</code></pre>\n<p>To allow secure access to the service, use Let's Encrypt certificates. Certificates can be installed with the <code>certbot</code> tool:</p>\n<pre class=\"prettyprint\">certbot --nginx -d accounts.jobsity.ikoabo.com\n</code></pre>\n<p>Now you can restart the Nginx server and test the microservice.</p>\n<h2>Documentation</h2>\n<p>The project its distributed with a <code>docs</code> folder. This folder contains the Postman Collection with examples for each request and the API Documentation generated with <code>apidoc</code>. To regenerate the documentation run the following command:</p>\n<pre class=\"prettyprint lang-bash\">npm run apidoc\n</pre>\n"
  },
  "template": {
    "withCompare": false,
    "withGenerator": true
  },
  "sampleUrl": false,
  "defaultVersion": "0.0.0",
  "apidoc": "0.3.0",
  "generator": {
    "name": "apidoc",
    "time": "2020-08-08T07:44:02.760Z",
    "url": "http://apidocjs.com",
    "version": "0.24.0"
  }
}
